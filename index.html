<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Jastone90.GitHub.io : ">
    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">
    <script src='scripts/Chart.min.js'></script>


    <title>Loan Payment Visualizer</title>
</head>

<body>

<!-- HEADER -->
<div id="header_wrap" class="outer">
    <header class="inner">
        <a id="forkme_banner" href="http://www4.ncsu.edu/~jastone2/project/index.html">Fake Company Website for
            Reference</a>

        <h1 id="project_title">Loan Payment Visualizer</h1>

        <h2 id="project_tagline">Graphically understand the true cost of loans</h2>

    </header>
</div>

<!-- MAIN CONTENT -->
<div id="main_content_wrap" class="outer">
    <section id="main_content" class="inner">
        <h3>Enter your loan(s) below</h3>

        <p id="date"></p>


        <!-- Inputs -->
        <div>
            <label for="loanAmount">Loan Amount ($):</label>
            <input name="loanAmount" type="text" id="loanAmount"/>
        </div>
        <div>
            <label for="loanInterestRate">Loan Interest Rate (%):</label>
            <input name="loanInterestRate" type="text" id="loanInterestRate"/>
        </div>
        <div>
            <label for="minPayment">Minimum Monthly Payment ($):</label>
            <input name="minPayment" type="text" id="minPayment"/>
        </div>


        <button type="button" onclick="calculate()">
            Calculate Loan Repayment
        </button>
        <span id="errorSpan"></span>
        <hr width="900" noshade>



        <section id="debtGraphs">
            <div id="graphLeft">
                <canvas id="debtLineGraph" width="800" height="400"></canvas>
            </div>
            <div id="graphright">
                <canvas id="interestRatio" width="250" height="250"></canvas>
            </div>
        </section>
        <div id="pieLegend"></div>
        <h3 id="totalCost"></h3>


        <script type="text/javascript">

            //developmental small loan
            document.getElementById('loanAmount').value = 5000;
            document.getElementById('loanInterestRate').value = 7;
            document.getElementById('minPayment').value = 600;
            //developmental House loan
            //            document.getElementById('loanAmount').value= 238500;
            //            document.getElementById('loanInterestRate').value= 3.125;
            //            document.getElementById('minPayment').value= 1021.68;
            var debtLineChart;
            var debtPieChart;

            function calculate(e) {
                document.getElementById('errorSpan').innerHTML = "";
                if(debtLineChart){
                    debtLineChart.destroy();
                    debtPieChart.destroy();
                }

                var loan = parseFloat(document.getElementById('loanAmount').value);
                var interestRate = parseFloat(document.getElementById('loanInterestRate').value) / 100;
                var minPayment = parseFloat(document.getElementById('minPayment').value);

                if (minPayment < parseFloat(((loan * interestRate) / 12).toFixed(2))) {
                    document.getElementById('errorSpan').innerHTML = "Dude You need a higher minimum Payment";
                    return;
                }


                var date = new Date();
                var originalLoanAmount = loan;

                var label = (date.getMonth() + 1) + "/" + date.getFullYear();
                var debt = [loan];
                var dates = [label];
                var totalInterest = 0;
                while (loan > 0) {
                    var acruedInterest = parseFloat(((loan * interestRate) / 12).toFixed(2));
                    var decrementingDebt = minPayment - acruedInterest;
                    totalInterest = parseFloat((totalInterest + acruedInterest).toFixed(2));
                    loan = parseFloat((loan - decrementingDebt).toFixed(2));
                    if (loan < 0) loan = 0;
                    debt.push(loan);

                    date = new Date(date.setMonth(date.getMonth() + 1));
                    label = (date.getMonth() + 1) + "/" + date.getFullYear();
                    dates.push(label);
                }

                // Line Chart
                var debtLineData = {
                    labels: dates,
                    datasets: [
                        {
                            fillColor: "rgba(172,194,132,0.4)",
                            strokeColor: "#ACC26D",
                            pointColor: "#fff",
                            pointStrokeColor: "#9DB86D",
                            data: debt
                        }
                    ]
                };

                var pieData = [
                    {
                        label: "Principal",
                        value: originalLoanAmount,
                        color: "#4ACAB4"
                    },
                    {
                        label: "Interest",
                        value: totalInterest,
                        color: "#FF8153"
                    }

                ];
                var pieOptions = {
                    segmentShowStroke: false,
                    animateScale: true
                };


                // Line Chart

                var debtLineGraph = document.getElementById('debtLineGraph').getContext('2d');
                debtLineChart = new Chart(debtLineGraph).Line(debtLineData);
                //var debtLineGraph = document.getElementById('debtLineGraph').getContext('2d');
//                debtLineChart.datasets[0].label = dates;
//                debtLineChart.datasets[0].points = debt;
//                debtLineChart.update();
                // Pie Chart
                var interestRatio = document.getElementById("interestRatio").getContext("2d");
                debtPieChart = new Chart(interestRatio).Pie(pieData, pieOptions);
                document.getElementById('pieLegend').innerHTML = '<li><span style="background-color:#4ACAB4">Principal: $' + originalLoanAmount + '</span></li>' +
                                                                 '<li><span style="background-color:#FF8153">Interest: $' + totalInterest + '</span></li>';
                document.getElementById('totalCost').innerHTML = "Total Cost of the Loan: $" + (originalLoanAmount + totalInterest);
            }


        </script>
    </section>
</div>
</body>
<!-- FOOTER  -->
<div id="footer_wrap" class="outer">
    <footer class="inner">
        <p>Contact: jastone90@gmail.com</p>
    </footer>
</div>
</html>
